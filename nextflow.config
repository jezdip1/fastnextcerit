// ========== Kubernetes driver (head) ==========
k8s {
  namespace           = 'jezdik-ns'
  runAsUser           = 1000
  fsGroup             = 1000
  fsGroupChangePolicy = 'OnRootMismatch'
  seccompProfile      = 'RuntimeDefault'

  // PVC pro data (input|output)
  storageClaimName  = 'pvc-seg'
  storageMountPath  = '/mnt/data'

  // kde se ukládá workDir a configMap s kódem
  workDir           = '/mnt/data/work'
  projects          = '/mnt/data/projects'
}

// ========== Celkové procesní nastavení ==========
process {
  executor  = 'k8s'
  cpus      = 1
  memory    = '12 GB'
  container = 'jezdip1/fastsurfer-cerit:latest'
}

// ========== Label pro GPU-úlohy ==========
process {
  withLabel: 'gpu' {
    cpus      = 2
    memory    = '12 Gi'
    container = 'jezdip1/fastsurfer-cerit:latest'
    ext.k8s {
      limits = [ 'nvidia.com/gpu': '1', cpu: '2', memory: '12Gi' ]
      requests = [ 'nvidia.com/gpu': '1', cpu: '2', memory: '10Gi' ]
    }
  }
}

// Zmenšíme paralelní frontu, abychom nepřekročili kvóty
executor {
  queueSize = 5
}

// ========== Parametry pipeline ==========
params {
  input_dir = '/mnt/data/input'
  out_dir   = '/mnt/data/subjects'
  license   = '/mnt/data/license.txt'
}
