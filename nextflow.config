/////////////////////////////////////////////////
// Kubernetes / PVC mount
/////////////////////////////////////////////////

k8s {
  namespace            = 'jezdik-ns'
  storageClaimName     = 'pvc-seg'
  storageMountPath     = '/mnt/data'
  workDir              = '/mnt/data/work'
  launchDir            = '/mnt/data/launch'

  // driver i všechny podty musí mít token, jinak nevyvolají joby
  pod = [ automountServiceAccountToken: true ]

  securityContext = [
    runAsUser            : 1000,
    runAsNonRoot         : true,
    allowPrivilegeEscalation: false,
    capabilities         : [ drop: ['ALL'] ],
    seccompProfile       : [ type: 'RuntimeDefault' ]
  ]
}

/////////////////////////////////////////////////
// Executor a limite
/////////////////////////////////////////////////

executor {
  name      = 'k8s'
  queueSize = 4   // nepustí víc jak 4 paralelní pod-joby
}

process {
  executor  = 'k8s'
  cpus      = 1
  memory    = '12 GB'
  container = 'jezdip1/fastsurfer-cerit:latest'
}

/////////////////////////////////////////////////
// Parametry pipeline
/////////////////////////////////////////////////

params {
  input_dir  = '/mnt/data/input'
  license    = '/mnt/data/license.txt'
  output_dir = '/mnt/data/subjects'
}
