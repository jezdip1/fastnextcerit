// nextflow.config
k8s {
  namespace        = 'jezdik-ns'
  storageClaimName = 'pvc-seg'
  storageMountPath = '/mnt/data'
  workDir          = '/mnt/data/work'
  launchDir        = '/mnt/data/launch'
}

executor.queueSize = 2          // <-- globální strop (2 pody najednou)

process {
  cpus   = 1                    // musí být ≤ cpu limit
  memory = '8.GB'               // aby ses vešel do quota
  executor = 'k8s'

  // společné pod-security nastavení
  pod = [[
    securityContext:[
      runAsUser:1000,
      runAsNonRoot:true,
      seccompProfile:[type:'RuntimeDefault']
    ]
  ]]

  withLabel:'gpujob' {
    container = 'jezdip1/fastsurfer-cerit:latest'
    ext.k8s = [
      limits  : [cpu:'1', memory:'8Gi', 'nvidia.com/gpu':'1'],
      requests: [cpu:'1', memory:'8Gi', 'nvidia.com/gpu':'1']
    ]
    maxForks = 2               // <-- strop SPECIFICKY pro fastsurfer_seg
  }
}

