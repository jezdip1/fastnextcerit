// ---------------------------------------------------
// Executor + Kubernetes settings
// ---------------------------------------------------
executor {
  name      = 'k8s'
  queueSize = 5         // max 5 pods paralelně

  kubernetes {
    namespace           = 'jezdik-ns'
    storageClaimName    = 'pvc-seg'
    storageMountPath    = '/mnt/data'
    workDir             = '/mnt/data/work'
    runAsUser           = 1000
    runAsGroup          = 1000
    fsGroup             = 1000
    fsGroupChangePolicy = 'OnRootMismatch'
    seccompProfile      = 'RuntimeDefault'
  }
}

// ---------------------------------------------------
// Globální defaults pro každý process
// ---------------------------------------------------
process {
  cpus      = 1
  memory    = '12 GB'
  container = 'jezdip1/fastsurfer-cerit:latest'
}

// ---------------------------------------------------
// Label pro GPU joby
// ---------------------------------------------------
process {
  withLabel: 'gpu' {
    cpus      = 2
    memory    = '12 Gi'
    container = 'jezdip1/fastsurfer-cerit:latest'
    ext.k8s {
      requests = [ 'nvidia.com/gpu': '1', cpu: '2', memory: '10Gi' ]
      limits   = [ 'nvidia.com/gpu': '1', cpu: '2', memory: '12Gi' ]
    }
  }
}

// ---------------------------------------------------
// Parametry pipeline
// ---------------------------------------------------
params {
  input_dir = '/mnt/data/input'
  out_dir   = '/mnt/data/subjects'
  license   = '/mnt/data/license.txt'
}
