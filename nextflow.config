/*  nextflow.config  */
k8s {
  namespace          = 'jezdik-ns'
  storageClaimName   = 'pvc-seg'
  storageMountPath   = '/mnt/data'
  workDir            = '/mnt/data/work'
  launchDir          = '/mnt/data/launch'
  runAsUser          = 1000
}

params {
  input_dir = '/mnt/data/input'
  license   = '/mnt/data/license.txt'
  out_dir   = '/mnt/data/subjects'
}

process {
  executor = 'k8s'
  cpus     = 1
  memory   = '12.GB'

  /* ---------- POD SECURITY ---------- */
  pod = [[
    securityContext:[
      runAsUser      : 1000,
      runAsGroup     : 1000,
      runAsNonRoot   : true,
      fsGroup        : 1000,
      seccompProfile : [type:'RuntimeDefault']
    ]
  ]]

  /* ---------- GPU varianta ---------- */
  withLabel:'gpujob' {
    container = 'jezdip1/fastsurfer-cerit:latest'
    ext.k8s = [
      limits  : [ cpu:'1', memory:'12Gi', 'nvidia.com/gpu':'1' ],
      requests: [ cpu:'1', memory:'12Gi', 'nvidia.com/gpu':'1' ]
    ]
  }
}
