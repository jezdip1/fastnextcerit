k8s {
  namespace = 'jezdik-ns'
  runAsUser = 1000
  computeResourceType = 'Job'
  cpuLimits = true
  storageClaimName = 'pvc-seg'
  storageMountPath = '/mnt/data'
  launchDir = '/mnt/data/launch'
  workDir = '/mnt/data/work'
}

executor {
  queueSize = 30
}

params {
  input_dir = '/mnt/data/input'
  license = '/mnt/data/license.txt'
}

process {
  executor = 'k8s'
  memory = '12 GB'
  cpus = 2

  pod = [
    [securityContext: [
      fsGroupChangePolicy: 'OnRootMismatch',
      runAsUser: 1000,
      runAsGroup: 1,
      fsGroup: 1,
      seccompProfile: [type: 'RuntimeDefault']
    ]],
    [automountServiceAccountToken: false]
  ]

  withLabel: 'gpujob' {
    container = 'deepmi/fastsurfer:latest'
    ext.k8s = [
      limits: [
        cpu: '2',
        memory: '12Gi',
        'nvidia.com/gpu': '1'
      ],
      requests: [
        cpu: '2',
        memory: '10Gi',
        'nvidia.com/gpu': '1'
      ]
    ]
  }
}
