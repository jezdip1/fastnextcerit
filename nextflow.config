k8s {
  namespace         = 'jezdik-ns'
  runAsUser         = 1000
  computeResourceType = 'Job'
  cpuLimits         = true
  storageClaimName  = 'pvc-seg'
  storageMountPath  = '/mnt/data'
  launchDir         = '/mnt/data/launch'
  workDir           = '/mnt/data/work'
}

params {
  input_dir = '/mnt/data/input'
  license   = '/mnt/data/license.txt'
}

process {
  executor = 'k8s'
  cpus     = 2
  memory   = '12 GB'

  /**
   * Přepíšeme container ENTRYPOINT =&gt; nastavíme přímo command /bin/bash -c
   * $(nxf_script) doplní Nextflow jméno temp-skriptu s tvým "shell:" blokem
   */
  ext.k8s = [
    command: [ '/bin/bash', '-c' ],
    args   : [ '$(nxf_script)' ],
    resources: [
      limits:   [cpu:'2', memory:'12Gi', 'nvidia.com/gpu':'1'],
      requests: [cpu:'2', memory:'10Gi', 'nvidia.com/gpu':'1']
    ],
    securityContext: [
      runAsNonRoot: true,
      runAsUser   : 1000,
      allowPrivilegeEscalation: false,
      seccompProfile: [ type: 'RuntimeDefault' ],
      capabilities: [ drop:['ALL'] ]
    ]
  ]
}
