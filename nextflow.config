k8s {
    namespace        = 'jezdik-ns'
    storageClaimName = 'pvc-seg'
    storageMountPath = '/mnt/data'
    workDir          = '/mnt/data/work'
    launchDir        = '/mnt/data/launch'
    runAsUser        = 1000
    computeResourceType = 'Job'

    headPodOptions = {
        securityContext = [
            runAsNonRoot             : true,
            runAsUser                : 1000,
            allowPrivilegeEscalation : false,
            seccompProfile           : [ type: 'RuntimeDefault' ],
            capabilities             : [ drop: ['ALL'] ]
        ]
        automountServiceAccountToken = false
    }
}

process {
    executor = 'k8s'
    cpus     = 2
    memory   = '12 GB'

    podOptions = {
        securityContext = [
            runAsNonRoot             : true,
            runAsUser                : 1000,
            allowPrivilegeEscalation : false,
            seccompProfile           : [ type: 'RuntimeDefault' ],
            capabilities             : [ drop: ['ALL'] ]
        ]
        automountServiceAccountToken = false
    }

    withLabel: gpujob {
        container = 'jezdip1/fastsurfer-cerit:latest'
        ext.k8s = [
            limits   : [ cpu:'2', memory:'12Gi', 'nvidia.com/gpu':'1' ],
            requests : [ cpu:'2', memory:'10Gi', 'nvidia.com/gpu':'1' ]
        ]
    }
}

params {
    input_dir = '/mnt/data/input'
    license   = '/mnt/data/license.txt'
    out_dir   = '/mnt/data/subjects'   // kam chceme publikovat v√Ωsledky
}

executor {
    queueSize = 30
}
