k8s {
    namespace          = 'jezdik-ns'
    storageClaimName   = 'pvc-seg'
    storageMountPath   = '/mnt/data'
    workDir            = '/mnt/data/work'
    launchDir          = '/mnt/data/launch'

    runAsUser          = 1000
    securityContext    = [
      runAsNonRoot          : true,
      allowPrivilegeEscalation: false,
      capabilities          : [ drop: ['ALL'] ],
      seccompProfile        : [ type: 'RuntimeDefault' ]
    ]
    pod = [ automountServiceAccountToken: false ]
}

executor {
    name       = 'k8s'
    queueSize  = 5
}

process {
    executor  = 'k8s'
    container = 'jezdip1/fastsurfer-cerit:latest'
    cpus      = 1
    memory    = '12 GB'

    withLabel: gpujob {
        ext.k8s = [
          limits  : [ 'nvidia.com/gpu': '1' ],
          requests: [ 'nvidia.com/gpu': '1' ]
        ]
    }
}

params {
    input_dir   = '/mnt/data/input'
    license     = '/mnt/data/license.txt'
    output_dir  = '/mnt/data/subjects'
}
