//
k8s {
    /* ===== driver-pod ===== */
    namespace        = 'jezdik-ns'
    launchDir        = '/mnt/data/launch'
    workDir          = '/mnt/data/work'
    storageClaimName = 'pvc-seg'
    storageMountPath = '/mnt/data'

    /* driver-pod security (root, ale se seccomp) */
    pod = [
      [ securityContext: [
            seccompProfile: [ type: 'RuntimeDefault' ]
        ]]
    ]
}

/* ===== výchozí nastavení pro všechny procesy ===== */
process {
    executor = 'k8s'
    cpus     = 2
    memory   = '12.GB'

    /* task-pod security (non-root) + GPU limity */
    pod = [[
        securityContext: [
            runAsUser:      1000,
            runAsGroup:     1000,
            runAsNonRoot:   true,
            fsGroup:        1000,
            seccompProfile: [ type: 'RuntimeDefault' ]
        ]
    ]]

    ext.k8s = [
        limits:   [ cpu:'2', memory:'12Gi', 'nvidia.com/gpu':'1' ],
        requests: [ cpu:'2', memory:'12Gi', 'nvidia.com/gpu':'1' ]
    ]
}

/* label pro GPU image */
process.withLabel: gpujob {
    container = 'jezdip1/fastsurfer-cerit:latest'
}

/* ---------- parametry ---------- */
params {
    input_dir = '/mnt/data/input'         // *.nii soubory
    out_dir   = '/mnt/data/subjects'      // kam FastSurfer ukládá
    license   = '/mnt/data/license.txt'   // FreeSurfer licence
}
