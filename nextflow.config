// Kubernetes-specifické nastavení
k8s {
  namespace           = 'jezdik-ns'
  storageClaimName    = 'pvc-seg'
  storageMountPath    = '/mnt/data'
  launchDir           = '/mnt/data/launch'
  workDir             = '/mnt/data/work'
  runAsUser           = 1000
  cpuLimits           = true
  computeResourceType = 'Job'
}

// Front-end executor queue
executor {
  queueSize = 30
}

// Výchozí procesy
process {
  executor = 'k8s'
  cpus     = 2
  memory   = '12 GB'
  // Bez podOptions tady – to budeme definovat jen pro gpujob

  // Procesy označené štítkem 'gpujob' poběží ve vašem FastSurfer image
  withLabel: gpujob {
    container = 'deepmi/fastsurfer:latest'
    ext.k8s = [
      requests: [ cpu: '2',    memory: '10Gi', 'nvidia.com/gpu': '1' ],
      limits:   [ cpu: '2',    memory: '12Gi', 'nvidia.com/gpu': '1' ]
    ]
    podOptions = [
      securityContext: [
        runAsNonRoot:           true,
        runAsUser:              1000,
        allowPrivilegeEscalation: false,
        seccompProfile: [ type: 'RuntimeDefault' ],
        capabilities:    [ drop: ['ALL'] ]
      ]
    ]
  }
}

// Parametry pro vaši pipeline
params {
  input_dir = '/mnt/data/input'
  license   = '/mnt/data/license.txt'
}
