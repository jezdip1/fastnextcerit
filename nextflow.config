/////////////////////////////////////////////////////////////
// Kubernetes driver & executor settings
/////////////////////////////////////////////////////////////

k8s {
    namespace            = 'jezdik-ns'
    // mount your PVC into the driver pod at /mnt/data
    storageClaimName     = 'pvc-seg'
    storageMountPath     = '/mnt/data'
    workDir              = '/mnt/data/work'
    launchDir            = '/mnt/data/launch'

    // run as non-root everywhere
    runAsUser            = 1000
    securityContext = [
      fsGroup                     : 1000,
      runAsNonRoot                : true,
      allowPrivilegeEscalation    : false,
      capabilities                : [ drop: ['ALL'] ],
      seccompProfile              : [ type: 'RuntimeDefault' ]
    ]

    // MUST be true so driver can talk to k8s
    pod = [
      automountServiceAccountToken: true
    ]
}

/////////////////////////////////////////////////////////////
// Nextflow executor defaults
/////////////////////////////////////////////////////////////

executor {
    name       = 'k8s'
    // max pods in flight at once
    queueSize  = 5
}

process {
    executor  = 'k8s'
    cpus      = 1
    memory    = '12 GB'
    // make sure every process uses your patched FastSurfer image
    container = 'jezdip1/fastsurfer-cerit:latest'
}

/////////////////////////////////////////////////////////////
// Pipeline parameters
/////////////////////////////////////////////////////////////

params {
    input_dir   = '/mnt/data/input'
    license     = '/mnt/data/license.txt'
    output_dir  = '/mnt/data/subjects'
}
