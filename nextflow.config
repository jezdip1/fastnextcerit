process {
  executor  = 'k8s'
  container = 'cerit.io/nextflow/nextflow:24.04.4'
  cpus      = 1
  memory    = '12 GB'

  withLabel: gpujob {
    // use your FastSurfer GPU image
    container = 'jezdip1/fastsurfer-cerit:latest'
    // bump cpus & memory to match your GPU job
    cpus   = 2
    memory = '12 GB'

    ext.k8s = [
      resources: [
        // ask K8s for 1 GPU plus 2 CPUs, 10Gi RAM request / 12Gi limit
        requests: [ 'nvidia.com/gpu': '1', cpu: '2', memory: '10Gi' ],
        limits:   [ 'nvidia.com/gpu': '1', cpu: '2', memory: '12Gi' ]
      ],
      // if your cluster advertises GPU nodes by label
      nodeSelector: [ 'nvidia.com/gpu.present':'true' ],
      securityContext: [
        runAsNonRoot:             true,
        runAsUser:                1000,
        allowPrivilegeEscalation: false,
        capabilities: [ drop: ['ALL'] ],
        seccompProfile: [ type: 'RuntimeDefault' ]
      ]
    ]
  }
}
