/*
 * ===  nextflow.config  =========================================
 */

k8s {
  namespace           = 'jezdik-ns'
  storageClaimName    = 'pvc-seg'
  storageMountPath    = '/mnt/data'
  workDir             = '/mnt/data/work'
  launchDir           = '/mnt/data/launch'
  runAsUser           = 1000
  computeResourceType = 'Job'
  cpuLimits           = true
}

params {
  input_dir = '/mnt/data/input'
  license   = '/mnt/data/license.txt'
}

process {
  executor         = 'k8s'
  container        = 'deepmi/fastsurfer:latest'

  /* ✨ klíčová položka – přepíšeme ENTRYPOINT na /bin/bash */
  containerOptions = '--entrypoint /bin/bash'  

  cpus   = 2
  memory = '12 GB'

  pod = [[
      securityContext:[
          runAsUser           : 1000,
          runAsGroup          : 1000,
          fsGroup             : 1000,
          fsGroupChangePolicy : 'OnRootMismatch',
          seccompProfile      : [type:'RuntimeDefault']
      ]
  ],
  [automountServiceAccountToken:false]]

  ext.k8s = [
      limits  : [cpu:'2', memory:'12Gi', 'nvidia.com/gpu':'1'],
      requests: [cpu:'2', memory:'10Gi', 'nvidia.com/gpu':'1']
  ]
}

executor {
  queueSize = 30
}
